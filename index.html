// =================================================================
// NOVO C√ìDIGO: FUN√á√ïES DE TRANSA√á√ÉO (DEP√ìSITO E SAQUE DE TOKEN)
// =================================================================

async function depositToken(address) {
    if (!userAddress) {
        showAlert('‚ùå Conecte sua carteira primeiro!', 'error');
        return;
    }

    const amountInput = document.getElementById('depositAmount');
    const amount = amountInput.value.trim();

    if (!amount || parseFloat(amount) <= 0) {
        showAlert('‚ùå Digite um valor v√°lido para dep√≥sito.', 'error');
        return;
    }

    showLoading(true);

    try {
        const amountUSDC = ethers.utils.parseUnits(amount, 6); // USDC tem 6 decimais

        // 1. Verificar Allowance (Aprova√ß√£o)
        showAlert('‚è≥ Verificando permiss√£o (Allowance) para USDC...', 'info');
        const allowance = await usdcContract.allowance(userAddress, address);
        
        // Se a permiss√£o for menor que o valor a depositar, solicita aprova√ß√£o
        if (allowance.lt(amountUSDC)) {
            showAlert('üìù Aprovando USDC... Confirme a transa√ß√£o de Aprova√ß√£o na MetaMask.', 'info');
            
            // Aprova um valor m√°ximo para evitar solicita√ß√µes futuras
            const approveTx = await usdcContract.approve(
                address, 
                ethers.constants.MaxUint256, 
                { value: 0 } // CORRE√á√ÉO: Garante que n√£o envia ARC
            ); 
            await approveTx.wait();
            showAlert('‚úÖ Aprova√ß√£o de USDC bem-sucedida.', 'success');
        }

        // 2. Realizar Dep√≥sito
        showAlert('üìù Realizando Dep√≥sito... Confirme a transa√ß√£o de Dep√≥sito na MetaMask.', 'info');
        const splitterContract = new ethers.Contract(address, SPLITTER_ABI, signer);

        const tx = await splitterContract.depositarToken(
            CONFIG.usdcAddress, 
            amountUSDC,
            { value: 0 } // CORRE√á√ÉO: Garante que n√£o envia ARC
        );
        
        await tx.wait();
        showAlert(`‚úÖ Dep√≥sito de ${amount} USDC realizado com sucesso!`, 'success');
        
        // Recarregar dados ap√≥s o dep√≥sito
        await openModal(address); 
        await loadMySplitters();
        await loadBeneficiarySplitters();

    } catch (error) {
        console.error('Erro ao depositar:', error);
        showAlert('‚ùå Erro ao depositar: ' + error.message, 'error');
    } finally {
        showLoading(false);
    }
}

async function withdrawToken(address) {
    if (!userAddress) {
        showAlert('‚ùå Conecte sua carteira primeiro!', 'error');
        return;
    }

    showLoading(true);

    try {
        showAlert('üìù Solicitando Saque... Confirme a transa√ß√£o na MetaMask.', 'info');
        const splitterContract = new ethers.Contract(address, SPLITTER_ABI, signer);
        
        const tx = await splitterContract.sacarToken(CONFIG.usdcAddress);
        
        await tx.wait();
        showAlert('‚úÖ Saque de USDC realizado com sucesso!', 'success');
        
        // Recarregar dados ap√≥s o saque
        await openModal(address); 
        await loadMySplitters();
        await loadBeneficiarySplitters();

    } catch (error) {
        console.error('Erro ao sacar:', error);
        showAlert('‚ùå Erro ao sacar: ' + error.message, 'error');
    } finally {
        showLoading(false);
    }
}

// =================================================================
// FUN√á√ïES DE UTILIDADE (J√° existentes, apenas para refer√™ncia)
// =================================================================

function showAlert(message, type) { /* ... */ }
function showLoading(show) { /* ... */ }
function switchTab(tabName) { /* ... */ }

// ... e o resto das fun√ß√µes (connectWallet, createSplitter, loadMySplitters, etc.)
